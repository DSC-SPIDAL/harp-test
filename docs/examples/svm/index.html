<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp-test/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp-test/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp-test/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp Support Vector Machine"><meta property="og:url" content="/docs/examples/svm/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp Support Vector Machine</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp-test/"><img class="pull-left" src="https://dsc-spidal.github.io/harp-test/img/0-1-2.png" width="62%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp-test/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp-test/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/nn">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp Support Vector Machine</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp-test/img/4-4-1.png" width="50%"  ></p>

<p>In machine learning, support vector machines (SVM) are supervised learning models with associated learning algorithms that analyze data used for classification and regression analysis. Given a set of training examples, each is marked as belonging to one or the other of two categories, an SVM training algorithm builds a model that assigns new examples to one category or the other, making it a non-probabilistic binary linear classifier. An SVM model is a representation of the examples as points in space, mapped so that the examples of the separate categories are divided by a clear gap that is as wide as possible. New examples are then mapped into that same space and are predicted to belong to a category based on which side of the gap they fall.</p>

<p>In addition to performing linear classification, SVMs can efficiently perform a non-linear classification using what is called the kernel trick, implicitly mapping their inputs into high-dimensional feature spaces.</p>

<p>In this project, Harp won&rsquo;t touch the core code base of computing SVM. It will use LibSVM, which is an open source library and does parallel around LibSVM. And it is developed at the National Taiwan University and written in C++ with other programming languages&rsquo; APIs. LibSVM implements the SMO algorithm for kernelized support vector machines (SVMs), supporting classification and regression.</p>

<h2 id="method">METHOD</h2>

<p>The Harp based SVM algorithm works as follows:</p>

<ol>
<li><p>The training set of the algorithm is split into subsets.</p></li>

<li><p>Each node trains sub dataset locally via LibSVM&rsquo;s API.</p></li>

<li><p>Allgather support vectors to global.</p></li>

<li><p>Each node combines its training data and the global support vectors.</p></li>

<li><p>Repeat Step 2 to 4 until support vectors don&rsquo;t change any more.</p></li>
</ol>

<p><img src="https://dsc-spidal.github.io/harp-test/img/4-4-2.png" alt="SVM-2" /></p>

<p>The source code can be found in Harp GitHub repository by click <a href="https://github.com/DSC-SPIDAL/harp/tree/master/harp-tutorial-app/src/main/java/edu/iu/svm">Harp SVM</a>.</p>

<h2 id="step-0-data-preprocessing">Step 0 &mdash; Data preprocessing</h2>

<p>Harp SVM will follow LibSVM&rsquo;s data format. Each data point in a file is represented by a line of the format <code>&lt;label&gt; [&lt;fid&gt;:&lt;feature&gt;]</code>:</p>

<ul>
<li><code>&lt;label&gt;</code> which is 1 or -1</li>
<li><code>&lt;fid&gt;</code> is a positive feature id</li>
<li><code>&lt;feature&gt;</code> is the feature value</li>
</ul>

<p>After preprocessing, push the data set into HDFS by the following commands.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>hdfs dfs -mkdir /input
hdfs dfs -put input_data/* /input
</code></pre></div>

<h2 id="step-1-initialize-and-load-data">Step 1 &mdash; Initialize and load data</h2>
<div class="highlight"><pre><code class="language-Java" data-lang="Java"><span></span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">vy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;();</span>
<span class="n">Vector</span><span class="o">&lt;</span><span class="n">svm_node</span><span class="o">[]&gt;</span> <span class="n">vx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">svm_node</span><span class="o">[]&gt;();</span>
<span class="n">Vector</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">svy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;();</span>
<span class="n">Vector</span><span class="o">&lt;</span><span class="n">svm_node</span><span class="o">[]&gt;</span> <span class="n">svx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">svm_node</span><span class="o">[]&gt;();</span>
<span class="kt">int</span> <span class="n">maxIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="c1">//read data from HDFS</span>
<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">dataFile</span> <span class="o">:</span> <span class="n">dataFiles</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FileSystem</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">FileSystem</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">configuration</span><span class="o">);</span>
    <span class="n">Path</span> <span class="n">dataPath</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Path</span><span class="o">(</span><span class="n">dataFile</span><span class="o">);</span>
    <span class="n">FSDataInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">dataPath</span><span class="o">);</span>
    <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">in</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">StringTokenizer</span> <span class="n">st</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">line</span><span class="o">,</span><span class="s">&quot; \t\n\r\f:&quot;</span><span class="o">);</span>
        <span class="n">vy</span><span class="o">.</span><span class="na">addElement</span><span class="o">(</span><span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">()).</span><span class="na">doubleValue</span><span class="o">());</span>
        <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="na">countTokens</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
        <span class="n">svm_node</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_node</span><span class="o">[</span><span class="n">m</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_node</span><span class="o">();</span> 
            <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">index</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span>
            <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">value</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">()).</span><span class="na">doubleValue</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">maxIndex</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">maxIndex</span><span class="o">,</span><span class="n">x</span><span class="o">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">].</span><span class="na">index</span><span class="o">);</span>
        <span class="n">vx</span><span class="o">.</span><span class="na">addElement</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">originTrainingData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">vy</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="n">vy</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span><span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)[</span><span class="n">j</span><span class="o">].</span><span class="na">index</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)[</span><span class="n">j</span><span class="o">].</span><span class="na">value</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)[</span><span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">].</span><span class="na">index</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)[</span><span class="n">vx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">].</span><span class="na">value</span><span class="o">;</span>
    <span class="n">originTrainingData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//initial svm paramter</span>
<span class="n">svmParameter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_parameter</span><span class="o">();</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">svm_type</span> <span class="o">=</span> <span class="n">svm_parameter</span><span class="o">.</span><span class="na">C_SVC</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">kernel_type</span> <span class="o">=</span> <span class="n">svm_parameter</span><span class="o">.</span><span class="na">RBF</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">degree</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">gamma</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">coef0</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">nu</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">cache_size</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">C</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">eps</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">p</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">shrinking</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">probability</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">nr_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">weight_label</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">svmParameter</span><span class="o">.</span><span class="na">weight</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
</code></pre></div>

<h2 id="step-2-train-via-libsvm-s-api">Step 2 &mdash;Train via LibSVM&rsquo;s API</h2>
<div class="highlight"><pre><code class="language-Java" data-lang="Java"><span></span><span class="c1">//initial svm problem</span>
<span class="n">svmProblem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_problem</span><span class="o">();</span>
<span class="n">svmProblem</span><span class="o">.</span><span class="na">l</span> <span class="o">=</span> <span class="n">currentTrainingData</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
<span class="n">svmProblem</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_node</span><span class="o">[</span><span class="n">svmProblem</span><span class="o">.</span><span class="na">l</span><span class="o">][];</span>
<span class="n">svmProblem</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="n">svmProblem</span><span class="o">.</span><span class="na">l</span><span class="o">];</span>
<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="n">currentTrainingData</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">StringTokenizer</span> <span class="n">st</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">line</span><span class="o">,</span><span class="s">&quot; \t\n\r\f:&quot;</span><span class="o">);</span>
    <span class="n">svmProblem</span><span class="o">.</span><span class="na">y</span><span class="o">[</span><span class="n">id</span><span class="o">]</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">()).</span><span class="na">doubleValue</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="na">countTokens</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
    <span class="n">svm_node</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_node</span><span class="o">[</span><span class="n">m</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">svm_node</span><span class="o">();</span> 
        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">index</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span>
        <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">value</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">()).</span><span class="na">doubleValue</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">svmProblem</span><span class="o">.</span><span class="na">x</span><span class="o">[</span><span class="n">id</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="n">id</span><span class="o">++;</span>
<span class="o">}</span>

<span class="c1">//compute model</span>
<span class="n">svmModel</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="na">svm_train</span><span class="o">(</span><span class="n">svmProblem</span><span class="o">,</span> <span class="n">svmParameter</span><span class="o">);</span>
</code></pre></div>

<h2 id="step-3-communication-among-nodes">Step 3 &mdash; Communication among nodes</h2>
<div class="highlight"><pre><code class="language-Java" data-lang="Java"><span></span><span class="n">Table</span><span class="o">&lt;</span><span class="n">HarpString</span><span class="o">&gt;</span> <span class="n">svTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Table</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="k">new</span> <span class="n">HarpStringPlus</span><span class="o">());</span>

<span class="n">HarpString</span> <span class="n">harpString</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HarpString</span><span class="o">();</span>
<span class="n">harpString</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">svmModel</span><span class="o">.</span><span class="na">l</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">harpString</span><span class="o">.</span><span class="na">s</span> <span class="o">+=</span> <span class="n">svmProblem</span><span class="o">.</span><span class="na">y</span><span class="o">[</span><span class="n">svmModel</span><span class="o">.</span><span class="na">sv_indices</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span><span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">harpString</span><span class="o">.</span><span class="na">s</span> <span class="o">+=</span> <span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">].</span><span class="na">index</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">].</span><span class="na">value</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">harpString</span><span class="o">.</span><span class="na">s</span> <span class="o">+=</span> <span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">].</span><span class="na">index</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">svmModel</span><span class="o">.</span><span class="na">SV</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">].</span><span class="na">value</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Partition</span><span class="o">&lt;</span><span class="n">HarpString</span><span class="o">&gt;</span> <span class="n">pa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Partition</span><span class="o">&lt;</span><span class="n">HarpString</span><span class="o">&gt;(</span><span class="mi">0</span><span class="o">,</span> <span class="n">harpString</span><span class="o">);</span>
<span class="n">svTable</span><span class="o">.</span><span class="na">addPartition</span><span class="o">(</span><span class="n">pa</span><span class="o">);</span>

<span class="n">allreduce</span><span class="o">(</span><span class="s">&quot;main&quot;</span><span class="o">,</span> <span class="s">&quot;allreduce_&quot;</span> <span class="o">+</span> <span class="n">iter</span><span class="o">,</span> <span class="n">svTable</span><span class="o">);</span>

<span class="n">supportVectors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">svString</span> <span class="o">=</span> <span class="n">svTable</span><span class="o">.</span><span class="na">getPartition</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">().</span><span class="na">get</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="n">svString</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">supportVectors</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">line</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">supportVectors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<h2 id="usage">USAGE</h2>

<p>Run Harp SVM:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ hadoop jar build/harp3-app-hadoop-2.6.0.jar edu.iu.svm.IterativeSVM &lt;number of mappers&gt; &lt;number of iteration&gt; &lt;output path in HDFS&gt; &lt;data <span class="nb">set</span> path&gt;
</code></pre></div>

<p>Fetch the result:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ hdfs dfs -get &lt;output path in HDFS&gt; &lt;path you want to store the output&gt;
</code></pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp-test/js/app.min.js"></script></body></html>