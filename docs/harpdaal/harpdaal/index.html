<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp-test/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp-test/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp-test/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp-DAAL Framework"><meta property="og:url" content="/docs/harpdaal/harpdaal/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp-DAAL Framework</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp-test/"><img class="pull-left" src="https://dsc-spidal.github.io/harp-test/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp-test/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp-test/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/rf">Random Forests</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp-DAAL Framework</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><a href="https://github.iu.edu/IU-Big-Data-Lab/Harp/tree/master/harp3-daal-app">harp3-daal-app</a> includes the application implemented within the Harp-DAAL framework.</p>

<h2 id="what-is-harp-daal">What is Harp-DAAL?</h2>

<p>Harp-DAAL is a new framework that aims to run data analytics algorithms on distributed HPC architectures. The framework consists of two layers. A communication layer is handled by Harp,
a communication library plug-in into Hadoop ecosystem. A computation layer is handled by Intel&rsquo;s Data Analytics Acceleration Library (DAAL), which is a library that provides
the users of highly optimized building blocks for data analytics and machine learning applications on Intel&rsquo;s architectures.</p>

<p><img src="https://dsc-spidal.github.io/harp-test/img/6-1-1.png" alt="Figure 1. Harp-DAAL Framework for Iterative Applications" /></p>

<p>Compared to contemporary communication libraries, such as Hadoop and Spark, Harp has the advantages as follows:</p>

<ul>
<li>Harp has MPI-like collective communication operations that are highly optimized for big data problems.</li>
<li>Harp has efficient and innovative computation models for different machine learning problems.</li>
</ul>

<p>However, the original Harp framework only supports development of Java applications, which is a common choice within the Hadoop ecosystem.
The downside of the pure Java implementation is the lack of support for emerging new hardware architectures such as Intel&rsquo;s Xeon Phi.
By invoking DAAL&rsquo;s native kernels, applications can leverage the huge number of threads on many-core platforms, which is a tremendous
advantages for computation-intensive data analytics algorithms. This is also the tendency of merging HPC and Big Data domain.</p>

<p><img src="https://dsc-spidal.github.io/harp-test/img/6-1-2.png" alt="Harp-DAAL within HPC-BigData Stack" /></p>

<p>Figure 2 shows the position of Harp-DAAL within the whole HPC-Big Data software stack.</p>

<h2 id="how-to-build-a-harp-daal-application">How to build a Harp-DAAL Application ?</h2>

<p>If you already have a legacy Harp application codes, you need only identify the local computation module, and replace it by invoking correspondent
DAAL kernels. Although DAAL&rsquo;s kernels are written in C/C++, it does provide users of a Java API. The API is highly packaged, and the users only need
a few lines of codes to finish the invocation of kernels. For instance, the main function of a PCA application in DAAL is shown as below:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">main</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">args</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">java</span><span style="color: #f92672">.</span><span style="color: #a6e22e">io</span><span style="color: #f92672">.</span><span style="color: #a6e22e">FileNotFoundException</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">java</span><span style="color: #f92672">.</span><span style="color: #a6e22e">io</span><span style="color: #f92672">.</span><span style="color: #a6e22e">IOException</span> <span style="color: #f92672">{</span>

     <span style="color: #75715e">/* Read a data set from a file and create a numeric table for storing the input data */</span>
     <span style="color: #f8f8f2">CSRNumericTable</span> <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Service</span><span style="color: #f92672">.</span><span style="color: #a6e22e">createSparseTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">datasetFileName</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">/* Create an algorithm to compute PCA decomposition using the correlation method */</span>
     <span style="color: #f8f8f2">Batch</span> <span style="color: #f8f8f2">pcaAlgorithm</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Batch</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">correlationDense</span><span style="color: #f92672">);</span>

     <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">intel</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">algorithms</span><span style="color: #f92672">.</span><span style="color: #a6e22e">covariance</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Batch</span> <span style="color: #f8f8f2">covarianceSparse</span>
         <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">intel</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">algorithms</span><span style="color: #f92672">.</span><span style="color: #a6e22e">covariance</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Batch</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">intel</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">algorithms</span><span style="color: #f92672">.</span><span style="color: #a6e22e">covariance</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">fastCSR</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">pcaAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setCovariance</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">covarianceSparse</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">/* Set the input data */</span>
     <span style="color: #f8f8f2">pcaAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">data</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">data</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">/* Compute PCA decomposition */</span>
     <span style="color: #f8f8f2">Result</span> <span style="color: #f8f8f2">res</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pcaAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>

     <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">eigenValues</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">res</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eigenValues</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">eigenVectors</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">res</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eigenVectors</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">Service</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printNumericTable</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Eigenvalues:&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">eigenValues</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">Service</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printNumericTable</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Eigenvectors:&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">eigenVectors</span><span style="color: #f92672">);</span>

     <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #a6e22e">dispose</span><span style="color: #f92672">();</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>DAAL&rsquo;s Java API is usually contains the following objects:</p>

<ul>
<li>Data: user&rsquo;s data packed in DAAL&rsquo;s data structure, e.g., NumericTable, DataCollection</li>
<li>Algorithm:  the engine of machine learning, each has three modes: Batch, Distri, Online</li>
<li>Input: the user&rsquo;s input data to Algorithm</li>
<li>Parameter: the parameters provided by users during the running of algorithms</li>
<li>Result: the feedback of Algorithm after running, retrieved by users</li>
</ul>

<p>Before invoking your DAAL kernels, you shall well choose the data structure that is most suitable to your problem. For many NumericTable types,
the Java API provides two ways of storing data. The first way is to store data on the JVM heap side, and whenever the native computation kernels require
the dataset, it will automatically copy the data from JVM heap to the off-heap memory space. The second way is to store data on Java&rsquo;s direct byte buffer, and
native computation kernels can access them directly without any data copy. Therefore, you should evaluate the overhead of loading and writing data from memory
in your application. For many data-intensive applications, it is wise to store the data on the direct byte buffer.</p>

<p>If you build your Harp-DAAL application from scratch, you should also well choose the data structure on the Harp side. The thumb rule is to allocate data in
contiguous primitive Java array, because most of DAAL&rsquo;s Java API only accepts primitive array as input arguments. If you use Harp&rsquo;s own Table structure, the
contained data is distributed into different partitions, then you may use the Harp-DAAL data conversion API to transfer the data between a Harp table and a DAAL
table.</p>

<h3 id="harp-daal-data-conversion-api">Harp-DAAL Data Conversion API</h3>

<p>Harp-DAAL now provides a group of classes under the path <em>Harp/harp3-daal-app/src/edu/iu/daal</em>, which manipulates the data transfer
between Harp&rsquo;s data structure and that of DAAL.</p>

<ul>
<li>RotatorDaal: a rotator which internally converts the H matrix from Harp table to DAAL&rsquo;s NumericTable</li>
<li>RotateTaskDaal: the tasks executed by RotatorDaal in the model rotation paradigm.</li>
<li>HomogenTableHarpMap: convert data between DAAL&rsquo;s HomogenNumericTable and Harp&rsquo;s map</li>
<li>HomogenTableHarpTable: convert data between DAAL&rsquo;s HomogenNumericTable and Harp&rsquo;s table</li>
</ul>

<p>Within the <em>RotatorDaal</em>, the data transfer between Harp and DAAL is also overlapped by the computation work in another pipeline. Thus, if there is enough computation workload, the
overhead of data conversion could be significantly reduced. It is also very straightforward to invoke these conversion tools.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//create a conversion class between harp map and daal&#39;s table</span>
<span style="color: #f8f8f2">HomogenTableHarpMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;</span> <span style="color: #f8f8f2">converter</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenTableHarpMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;(</span><span style="color: #f8f8f2">wMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_index</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_daal</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_size</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">convert_wTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">HarpToDaalDouble</span><span style="color: #f92672">();</span>

<span style="color: #75715e">//create a conversion class between a harp table and a daal table</span>
<span style="color: #f8f8f2">converter</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenTableHarpTable</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">I</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">P</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">P</span><span style="color: #f92672">&gt;</span> <span style="color: #f92672">&gt;(</span><span style="color: #f8f8f2">table</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal_table</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">table</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumPartitions</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">rdim</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">numThreads</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">converter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">HarpToDaalDouble</span><span style="color: #f92672">();</span>
</pre></div>

<h2 id="how-to-compile-and-run-harp-daal-application">How to Compile and Run Harp-DAAL Application ?</h2>

<h3 id="install-intel-s-daal">Install Intel&rsquo;s DAAL</h3>

<p>You can either download Intel&rsquo;s DAAL product with licence from their website <a href="https://software.intel.com/en-us/blogs/daal">https://software.intel.com/en-us/blogs/daal</a>, or build it from source code. DAAL&rsquo;s source code
is open-sourced and available on the GitHub.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>git clone https://github.com/01org/daal.git
</pre></div>

<p>After installation, you can run the bin/daalvars.sh script to set up all the DAAL related environment variables.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">source</span> /path-to-daal/bin/daalvars.sh intel64
</pre></div>

<p>The most important environment variable is the <em>DAALROOT</em>, which points to the path of DAAL&rsquo;s source code. You can run the examples of each algorithm within DAAL to test
the installation of your DAAL library.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$DAALROOT</span>/../__release_lnx/daal/examples/cpp
make <span style="color: #f92672">{</span>libia32<span style="color: #f8f8f2">|</span>soia32<span style="color: #f8f8f2">|</span>libintel64<span style="color: #f8f8f2">|</span>sointel64<span style="color: #f8f8f2">|</span>help<span style="color: #f92672">}</span> <span style="color: #f92672">[</span><span style="color: #f8f8f2">example</span><span style="color: #f92672">=</span>name<span style="color: #f92672">]</span> <span style="color: #f92672">[</span><span style="color: #f8f8f2">compiler</span><span style="color: #f92672">=</span>compiler_name<span style="color: #f92672">]</span> <span style="color: #f92672">[</span><span style="color: #f8f8f2">mode</span><span style="color: #f92672">=</span>mode_name<span style="color: #f92672">]</span> <span style="color: #f92672">[</span><span style="color: #f8f8f2">threading</span><span style="color: #f92672">=</span>threading_name<span style="color: #f92672">]</span>
</pre></div>

<h3 id="setup-daal-within-harp">Setup DAAL within Harp</h3>

<p>To use DAAL within Harp, you shall first add DAAL Java API to your Java source code</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// packages from Daal</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">com.intel.daal.services.DaalContext</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">com.intel.daal.algorithms.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">com.intel.daal.data_management.data.NumericTable</span><span style="color: #f92672">;</span>
</pre></div>

<p>To compile your Harp-DAAL codes by ant, add the following lines to your <em>build.xml</em></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;fileset</span> <span style="color: #a6e22e">dir=</span><span style="color: #e6db74">&quot;${env.DAALROOT}&quot;</span><span style="color: #f92672">&gt;</span>
<span style="color: #f92672">&lt;include</span> <span style="color: #a6e22e">name=</span><span style="color: #e6db74">&quot;**/*.jar&quot;</span> <span style="color: #f92672">/&gt;</span>
<span style="color: #f92672">&lt;include</span> <span style="color: #a6e22e">name=</span><span style="color: #e6db74">&quot;**/lib/*.jar&quot;</span> <span style="color: #f92672">/&gt;</span>
<span style="color: #f92672">&lt;/fileset&gt;</span>
</pre></div>

<p>Since DAAL&rsquo;s Java API will invoke the native DAAL kernels, we need to load the native lib files into Harp&rsquo;s environment in two steps</p>

<p>1.Load these required native libraries in HDFS</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/lib/intel64_lin/libJavaAPI.so /Hadoop/Libraries/
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/../tbb/lib/intel64_lin/gcc4.4/libtbb* /Hadoop/Libraries/
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/../../daal-misc/lib/libiomp5.so /Hadoop/Libraries/
</pre></div>

<p>2.Load native libraries from HDFS to distributed cache of Harp&rsquo;s program.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">/* Put shared libraries into the distributed cache */</span>
<span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getConf</span><span style="color: #f92672">();</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">createSymlink</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addCacheFile</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">URI</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/Hadoop/Libraries/libJavaAPI.so#libJavaAPI.so&quot;</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addCacheFile</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">URI</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/Hadoop/Libraries/libtbb.so.2#libtbb.so.2&quot;</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addCacheFile</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">URI</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/Hadoop/Libraries/libtbb.so#libtbb.so&quot;</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addCacheFile</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">URI</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/Hadoop/Libraries/libtbbmalloc.so.2#libtbbmalloc.so.2&quot;</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addCacheFile</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">URI</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/Hadoop/Libraries/libtbbmalloc.so#libtbbmalloc.so&quot;</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">DistributedCache</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addCacheFile</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">URI</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/Hadoop/Libraries/libiomp5.so#libiomp5.so&quot;</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp-test/js/app.min.js"></script></body></html>