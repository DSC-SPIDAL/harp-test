<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp-test/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp-test/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp-test/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Data Interfaces and Types"><meta property="og:url" content="/docs/programming/data-interface/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Data Interfaces and Types</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp-test/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp-test/"><img class="pull-left" src="https://dsc-spidal.github.io/harp-test/img/0-1-2.png" width="62%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp-test/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp-test/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/examples/nn">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/harpdaal/harpdaal">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp-test/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Data Interfaces and Types</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp-test/img/2-2-1.png" alt="data-abstraction" /></p>

<p>Harp provides three levels of data structures: arrays and objects, partition, and table. Arrays and Serializable objects are the basic data structures, which include:</p>

<ol>
<li><p><code>ByteArray</code>: an array with byte-type elements</p></li>

<li><p><code>ShortArray</code>: an array with short-type elements</p></li>

<li><p><code>IntArray</code>: an array with int-type elements</p></li>

<li><p><code>FloatArray</code>: an array with float-type elements</p></li>

<li><p><code>LongArray</code>: an array with long-type elements</p></li>

<li><p><code>DoubleArray</code>: an array with double-type elements</p></li>

<li><p><code>Writable</code>: serializable object</p></li>
</ol>

<p><code>Partition</code> is a wraper of the data structures shown above. Every partition has an ID. In collective communication, partitions from different processors with the same ID will be merged. The merge operation is defined by <code>PartitionCombiner</code>.</p>

<p><code>Table</code> is a container for partitions. It is a high-level data structure and the unit for collective communication.</p>

<h1 id="table-and-partitions">Table and Partitions</h1>

<p><img src="https://dsc-spidal.github.io/harp-test/img/3-1-2.png" alt="table-partition" /></p>

<p>An example of how to construct a table is:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Table</span><span class="o">&lt;</span><span class="n">DoubleArray</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Table</span><span class="o">&lt;&gt;(</span><span class="mi">0</span><span class="o">,</span> <span class="k">new</span> <span class="n">DoubleArrPlus</span><span class="o">());</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numPartitions</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">DoubleArray</span> <span class="n">array</span> <span class="o">=</span> <span class="n">DoubleArray</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">size</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">addPartition</span><span class="o">(</span><span class="k">new</span> <span class="n">Partition</span><span class="o">&lt;&gt;(</span><span class="n">i</span><span class="o">,</span> <span class="n">array</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div>

<p>In this example, it initiliazes a table which carries <code>DoubleArray</code> as the primitive data type. <code>DoubleArrPlus</code> is a <code>PartitionCombiner</code> used to define the merging operation of two partitions.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DoubleArrPlus</span> <span class="kd">extends</span> <span class="n">PartitionCombiner</span><span class="o">&lt;</span><span class="n">DoubleArray</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">PartitionStatus</span> <span class="nf">combine</span><span class="o">(</span><span class="n">DoubleArray</span> <span class="n">curPar</span><span class="o">,</span> <span class="n">DoubleArray</span> <span class="n">newPar</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">double</span><span class="o">[]</span> <span class="n">doubles1</span> <span class="o">=</span> <span class="n">curPar</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="kt">int</span> <span class="n">size1</span> <span class="o">=</span> <span class="n">curPar</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="kt">double</span><span class="o">[]</span> <span class="n">doubles2</span> <span class="o">=</span> <span class="n">newPar</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="kt">int</span> <span class="n">size2</span> <span class="o">=</span> <span class="n">newPar</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size1</span> <span class="o">!=</span> <span class="n">size2</span><span class="o">)</span> <span class="o">{</span>            <span class="k">return</span> <span class="n">PartitionStatus</span><span class="o">.</span><span class="na">COMBINE_FAILED</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size2</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">doubles1</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">doubles1</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">doubles2</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">PartitionStatus</span><span class="o">.</span><span class="na">COMBINED</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<h1 id="data-abstraction">Data Abstraction</h1>

<p><img src="https://dsc-spidal.github.io/harp-test/img/3-1-3.png" alt="data-types" /></p>

<p>The data abstraction is shown above. <code>Transferable</code> is ae higher interface compare to other data structures and <code>Simple</code> is the sub-interface for all primitive data structures. Here is an example of the primitive data strucutres.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright 2013-2016 Indiana University</span>
<span class="cm"> * </span>
<span class="cm"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm"> * you may not use this file except in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing, software</span>
<span class="cm"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm"> * See the License for the specific language governing permissions and</span>
<span class="cm"> * limitations under the License.</span>
<span class="cm"> */</span>

<span class="kn">package</span> <span class="nn">edu.iu.harp.resource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.DataOutput</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">edu.iu.harp.io.DataType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">edu.iu.harp.resource.Array</span><span class="o">;</span>

<span class="cm">/*******************************************************</span>
<span class="cm"> * IntArray class for managing int[] data.</span>
<span class="cm"> ******************************************************/</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">IntArray</span> <span class="kd">extends</span> <span class="n">Array</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">[]&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">IntArray</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
	<span class="kd">super</span><span class="o">(</span><span class="n">arr</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the number of Bytes of encoded data. One byte for storing DataType,</span>
<span class="cm">     * four bytes for storing the size, size*4 bytes for storing the data.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNumEnocdeBytes</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">5</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Encode the array as DataOutput</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">DataOutput</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
	<span class="n">out</span><span class="o">.</span><span class="na">writeByte</span><span class="o">(</span><span class="n">DataType</span><span class="o">.</span><span class="na">INT_ARRAY</span><span class="o">);</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span><span class="o">;</span>
	<span class="n">out</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
	<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	    <span class="n">out</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
	<span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Create an array. Firstly try to get an array from ResourcePool; if</span>
<span class="cm">     * failed, new an array.</span>
<span class="cm">     * </span>
<span class="cm">     * @param len</span>
<span class="cm">     * @param approximate</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">IntArray</span> <span class="nf">create</span><span class="o">(</span><span class="kt">int</span> <span class="n">len</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">approximate</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
	    <span class="kt">int</span><span class="o">[]</span> <span class="n">ints</span> <span class="o">=</span> <span class="n">ResourcePool</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getIntsPool</span><span class="o">().</span><span class="na">getArray</span><span class="o">(</span><span class="n">len</span><span class="o">,</span> <span class="n">approximate</span><span class="o">);</span>
	    <span class="k">if</span> <span class="o">(</span><span class="n">ints</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="n">IntArray</span><span class="o">(</span><span class="n">ints</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
	    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	    <span class="o">}</span>
	<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Release the array from the ResourcePool</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">release</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">ResourcePool</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getIntsPool</span><span class="o">().</span><span class="na">releaseArray</span><span class="o">(</span><span class="n">array</span><span class="o">);</span>
	<span class="k">this</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Free the array from the ResourcePool</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">free</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">ResourcePool</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getIntsPool</span><span class="o">().</span><span class="na">freeArray</span><span class="o">(</span><span class="n">array</span><span class="o">);</span>
	<span class="k">this</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp-test/js/app.min.js"></script></body></html>